<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git æŒ‡ä»¤ç·´ç¿’æ¨¡æ“¬å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap');
        .terminal-font { font-family: 'JetBrains Mono', monospace; }
        .typing-animation {
            border-right: 2px solid #10b981;
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 50% { border-color: #10b981; }
            51%, 100% { border-color: transparent; }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 min-h-screen text-white">
    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-2 bg-gradient-to-r from-green-400 to-blue-500 bg-clip-text text-transparent">
                ğŸš€ Git æŒ‡ä»¤ç·´ç¿’æ¨¡æ“¬å™¨
            </h1>
            <p class="text-gray-300">å¾ªåºæ¼¸é€²å­¸ç¿’ Gitï¼Œåœ¨å®‰å…¨çš„ç’°å¢ƒä¸­ç·´ç¿’æŒ‡ä»¤æ“ä½œ</p>
        </header>

        <div class="grid lg:grid-cols-3 gap-6">
            <!-- æ•™å­¸å…§å®¹å€ -->
            <div class="lg:col-span-1 bg-gray-800 rounded-xl p-6 shadow-2xl">
                <h2 class="text-xl font-bold mb-4 flex items-center">
                    ğŸ“š æ•™å­¸å…§å®¹
                </h2>
                
                <!-- é—œå¡é¸æ“‡ -->
                <div class="mb-6">
                    <div class="grid grid-cols-1 gap-2">
                        <button onclick="loadLesson(1)" class="lesson-btn bg-green-600 hover:bg-green-700 px-4 py-3 rounded-lg text-left transition-all duration-200 transform hover:scale-105">
                            <div class="font-semibold">ç¬¬1é—œï¼šGit åŸºç¤</div>
                            <div class="text-sm text-green-200">åˆå§‹åŒ–å€‰åº«ã€åŸºæœ¬é…ç½®</div>
                        </button>
                        <button onclick="loadLesson(2)" class="lesson-btn bg-blue-600 hover:bg-blue-700 px-4 py-3 rounded-lg text-left transition-all duration-200 transform hover:scale-105">
                            <div class="font-semibold">ç¬¬2é—œï¼šæª”æ¡ˆæ“ä½œ</div>
                            <div class="text-sm text-blue-200">addã€commitã€status</div>
                        </button>
                        <button onclick="loadLesson(3)" class="lesson-btn bg-purple-600 hover:bg-purple-700 px-4 py-3 rounded-lg text-left transition-all duration-200 transform hover:scale-105">
                            <div class="font-semibold">ç¬¬3é—œï¼šåˆ†æ”¯ç®¡ç†</div>
                            <div class="text-sm text-purple-200">branchã€checkoutã€merge</div>
                        </button>
                        <button onclick="loadLesson(4)" class="lesson-btn bg-orange-600 hover:bg-orange-700 px-4 py-3 rounded-lg text-left transition-all duration-200 transform hover:scale-105">
                            <div class="font-semibold">ç¬¬4é—œï¼šé ç«¯æ“ä½œ</div>
                            <div class="text-sm text-orange-200">remoteã€pushã€pull</div>
                        </button>
                    </div>
                </div>

                <!-- ç•¶å‰æ•™å­¸å…§å®¹ -->
                <div id="lesson-content" class="bg-gray-700 rounded-lg p-4 mb-4">
                    <h3 class="font-bold text-green-400 mb-2">æ­¡è¿ä¾†åˆ° Git ç·´ç¿’ï¼</h3>
                    <p class="text-sm text-gray-300 mb-3">é¸æ“‡ä¸Šæ–¹çš„é—œå¡é–‹å§‹å­¸ç¿’ã€‚æ¯å€‹é—œå¡éƒ½æœ‰è©³ç´°çš„èªªæ˜å’Œç·´ç¿’ä»»å‹™ã€‚</p>
                    <div class="text-xs text-yellow-300">ğŸ’¡ æç¤ºï¼šæŒ‰ç…§é †åºå®Œæˆé—œå¡ï¼Œå¾ªåºæ¼¸é€²æŒæ¡ Git æŠ€èƒ½ï¼</div>
                </div>

                <!-- ä»»å‹™æ¸…å–® -->
                <div id="task-list" class="bg-gray-700 rounded-lg p-4">
                    <h4 class="font-semibold mb-2 text-blue-400">ğŸ“‹ ä»»å‹™æ¸…å–®</h4>
                    <div id="tasks" class="space-y-2">
                        <div class="text-sm text-gray-400">é¸æ“‡é—œå¡å¾Œæœƒé¡¯ç¤ºä»»å‹™</div>
                    </div>
                </div>
            </div>

            <!-- æ¨¡æ“¬çµ‚ç«¯æ©Ÿå€ -->
            <div class="lg:col-span-2 bg-black rounded-xl p-6 shadow-2xl">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold flex items-center">
                        ğŸ’» Git æ¨¡æ“¬çµ‚ç«¯æ©Ÿ
                    </h2>
                    <button onclick="clearTerminal()" class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm transition-colors">
                        æ¸…é™¤
                    </button>
                </div>

                <!-- çµ‚ç«¯æ©Ÿè¼¸å‡º -->
                <div id="terminal-output" class="terminal-font bg-gray-900 rounded-lg p-4 h-80 overflow-y-auto mb-4 text-sm">
                    <div class="text-green-400">Git ç·´ç¿’æ¨¡æ“¬å™¨ v1.0</div>
                    <div class="text-gray-400">è¼¸å…¥ 'help' æŸ¥çœ‹å¯ç”¨æŒ‡ä»¤</div>
                    <div class="text-gray-400">è¼¸å…¥ 'tutorial' é–‹å§‹æ•™å­¸</div>
                    <div class="mt-2"></div>
                </div>

                <!-- æŒ‡ä»¤è¼¸å…¥ -->
                <div class="flex items-center bg-gray-900 rounded-lg p-3">
                    <span class="text-green-400 terminal-font mr-2">git-practice:~$</span>
                    <input 
                        type="text" 
                        id="command-input" 
                        class="flex-1 bg-transparent text-white terminal-font outline-none"
                        placeholder="è¼¸å…¥ Git æŒ‡ä»¤..."
                        onkeypress="handleCommand(event)"
                        autocomplete="off"
                    >
                </div>

                <!-- å¿«é€ŸæŒ‡ä»¤æŒ‰éˆ• -->
                <div class="mt-4">
                    <div class="text-sm text-gray-400 mb-2">å¿«é€ŸæŒ‡ä»¤ï¼š</div>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="insertCommand('git status')" class="bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded text-xs terminal-font transition-colors">git status</button>
                        <button onclick="insertCommand('git add .')" class="bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded text-xs terminal-font transition-colors">git add .</button>
                        <button onclick="insertCommand('git commit -m \"Initial commit\"')" class="bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded text-xs terminal-font transition-colors">git commit</button>
                        <button onclick="insertCommand('git log')" class="bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded text-xs terminal-font transition-colors">git log</button>
                        <button onclick="insertCommand('git branch')" class="bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded text-xs terminal-font transition-colors">git branch</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- é€²åº¦é¡¯ç¤º -->
        <div class="mt-6 bg-gray-800 rounded-xl p-4">
            <div class="flex items-center justify-between mb-2">
                <span class="font-semibold">å­¸ç¿’é€²åº¦</span>
                <span id="progress-text" class="text-sm text-gray-400">0/4 é—œå¡å®Œæˆ</span>
            </div>
            <div class="w-full bg-gray-700 rounded-full h-2">
                <div id="progress-bar" class="bg-gradient-to-r from-green-500 to-blue-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <script>
        // éŠæˆ²ç‹€æ…‹
        let gameState = {
            currentLesson: 0,
            completedLessons: [],
            repository: {
                initialized: false,
                files: {},
                staged: {},
                commits: [],
                branches: ['main'],
                currentBranch: 'main',
                remotes: {}
            },
            tasks: [],
            commandHistory: [],
            historyIndex: -1
        };

        // èª²ç¨‹å…§å®¹
        const lessons = {
            1: {
                title: "Git åŸºç¤è¨­å®š",
                content: `
                    <h3 class="font-bold text-green-400 mb-2">ç¬¬1é—œï¼šGit åŸºç¤è¨­å®š</h3>
                    <p class="text-sm text-gray-300 mb-3">å­¸ç¿’å¦‚ä½•åˆå§‹åŒ– Git å€‰åº«å’Œé€²è¡ŒåŸºæœ¬é…ç½®ã€‚</p>
                    <div class="text-xs space-y-1 mb-3">
                        <div><span class="text-yellow-400">git init</span> - åˆå§‹åŒ–æ–°çš„ Git å€‰åº«</div>
                        <div><span class="text-yellow-400">git config --global user.name</span> - è¨­å®šå…¨åŸŸä½¿ç”¨è€…åç¨±</div>
                        <div><span class="text-yellow-400">git config --global user.email</span> - è¨­å®šå…¨åŸŸä½¿ç”¨è€…ä¿¡ç®±</div>
                        <div><span class="text-yellow-400">git status</span> - æŸ¥çœ‹å€‰åº«ç‹€æ…‹</div>
                    </div>
                    <div class="text-xs text-blue-300">ğŸ’¡ Git æ˜¯ç‰ˆæœ¬æ§åˆ¶ç³»çµ±ï¼Œå¹«åŠ©ä½ è¿½è¹¤æª”æ¡ˆè®Šæ›´ï¼</div>
                `,
                tasks: [
                    { id: 1, text: "ä½¿ç”¨ git init åˆå§‹åŒ–å€‰åº«", completed: false },
                    { id: 2, text: "è¨­å®šä½¿ç”¨è€…åç¨± (git config --global user.name \"Your Name\")", completed: false },
                    { id: 3, text: "è¨­å®šä½¿ç”¨è€…ä¿¡ç®± (git config --global user.email \"your@email.com\")", completed: false },
                    { id: 4, text: "æŸ¥çœ‹å€‰åº«ç‹€æ…‹ (git status)", completed: false }
                ]
            },
            2: {
                title: "æª”æ¡ˆæ“ä½œ",
                content: `
                    <h3 class="font-bold text-blue-400 mb-2">ç¬¬2é—œï¼šæª”æ¡ˆæ“ä½œ</h3>
                    <p class="text-sm text-gray-300 mb-3">å­¸ç¿’å¦‚ä½•æ·»åŠ æª”æ¡ˆåˆ°æš«å­˜å€ä¸¦æäº¤è®Šæ›´ã€‚</p>
                    <div class="text-xs space-y-1 mb-3">
                        <div><span class="text-yellow-400">git add</span> - å°‡æª”æ¡ˆåŠ å…¥æš«å­˜å€</div>
                        <div><span class="text-yellow-400">git commit</span> - æäº¤è®Šæ›´</div>
                        <div><span class="text-yellow-400">git log</span> - æŸ¥çœ‹æäº¤æ­·å²</div>
                    </div>
                    <div class="text-xs text-blue-300">ğŸ’¡ æš«å­˜å€æ˜¯æäº¤å‰çš„æº–å‚™å€åŸŸï¼</div>
                `,
                tasks: [
                    { id: 1, text: "å‰µå»ºæª”æ¡ˆ (touch README.md)", completed: false },
                    { id: 2, text: "å°‡æª”æ¡ˆåŠ å…¥æš«å­˜å€ (git add README.md æˆ– git add .)", completed: false },
                    { id: 3, text: "æäº¤è®Šæ›´ (git commit -m \"commit message\")", completed: false },
                    { id: 4, text: "æŸ¥çœ‹æäº¤æ­·å² (git log)", completed: false }
                ]
            },
            3: {
                title: "åˆ†æ”¯ç®¡ç†",
                content: `
                    <h3 class="font-bold text-purple-400 mb-2">ç¬¬3é—œï¼šåˆ†æ”¯ç®¡ç†</h3>
                    <p class="text-sm text-gray-300 mb-3">å­¸ç¿’å¦‚ä½•å‰µå»ºå’Œç®¡ç†åˆ†æ”¯ï¼Œé€²è¡Œä¸¦è¡Œé–‹ç™¼ã€‚</p>
                    <div class="text-xs space-y-1 mb-3">
                        <div><span class="text-yellow-400">git branch</span> - æŸ¥çœ‹æˆ–å‰µå»ºåˆ†æ”¯</div>
                        <div><span class="text-yellow-400">git checkout</span> - åˆ‡æ›åˆ†æ”¯</div>
                        <div><span class="text-yellow-400">git merge</span> - åˆä½µåˆ†æ”¯</div>
                    </div>
                    <div class="text-xs text-blue-300">ğŸ’¡ åˆ†æ”¯è®“ä½ å¯ä»¥åŒæ™‚é€²è¡Œå¤šå€‹åŠŸèƒ½é–‹ç™¼ï¼</div>
                `,
                tasks: [
                    { id: 1, text: "æŸ¥çœ‹ç¾æœ‰åˆ†æ”¯ (git branch)", completed: false },
                    { id: 2, text: "å‰µå»ºæ–°åˆ†æ”¯ (git branch feature)", completed: false },
                    { id: 3, text: "åˆ‡æ›åˆ°æ–°åˆ†æ”¯ (git checkout feature)", completed: false },
                    { id: 4, text: "åˆ‡å›ä¸»åˆ†æ”¯ä¸¦åˆä½µ (git checkout main, git merge feature)", completed: false }
                ]
            },
            4: {
                title: "é ç«¯æ“ä½œ",
                content: `
                    <h3 class="font-bold text-orange-400 mb-2">ç¬¬4é—œï¼šé ç«¯æ“ä½œ</h3>
                    <p class="text-sm text-gray-300 mb-3">å­¸ç¿’å¦‚ä½•èˆ‡é ç«¯å€‰åº«äº’å‹•ï¼Œé€²è¡Œå”ä½œé–‹ç™¼ã€‚</p>
                    <div class="text-xs space-y-1 mb-3">
                        <div><span class="text-yellow-400">git remote</span> - ç®¡ç†é ç«¯å€‰åº«</div>
                        <div><span class="text-yellow-400">git push</span> - æ¨é€åˆ°é ç«¯</div>
                        <div><span class="text-yellow-400">git pull</span> - å¾é ç«¯æ‹‰å–</div>
                    </div>
                    <div class="text-xs text-blue-300">ğŸ’¡ é ç«¯å€‰åº«è®“åœ˜éšŠå¯ä»¥å”ä½œé–‹ç™¼ï¼</div>
                `,
                tasks: [
                    { id: 1, text: "æ·»åŠ é ç«¯å€‰åº« (git remote add origin <url>)", completed: false },
                    { id: 2, text: "æŸ¥çœ‹é ç«¯å€‰åº« (git remote -v)", completed: false },
                    { id: 3, text: "æ¨é€åˆ°é ç«¯ (git push origin main)", completed: false },
                    { id: 4, text: "å¾é ç«¯æ‹‰å– (git pull origin main)", completed: false }
                ]
            }
        };

        // è¼‰å…¥èª²ç¨‹
        function loadLesson(lessonNumber) {
            gameState.currentLesson = lessonNumber;
            const lesson = lessons[lessonNumber];
            
            document.getElementById('lesson-content').innerHTML = lesson.content;
            gameState.tasks = [...lesson.tasks];
            updateTaskList();
            
            addToTerminal(`\nğŸ“š è¼‰å…¥ç¬¬${lessonNumber}é—œï¼š${lesson.title}`, 'text-blue-400');
            addToTerminal('é–‹å§‹å®Œæˆä»»å‹™æ¸…å–®ä¸­çš„é …ç›®ï¼', 'text-gray-400');
        }

        // æ›´æ–°ä»»å‹™æ¸…å–®
        function updateTaskList() {
            const tasksContainer = document.getElementById('tasks');
            tasksContainer.innerHTML = '';
            
            gameState.tasks.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = `flex items-center text-sm ${task.completed ? 'text-green-400' : 'text-gray-300'}`;
                taskElement.innerHTML = `
                    <span class="mr-2">${task.completed ? 'âœ…' : 'â­•'}</span>
                    ${task.text}
                `;
                tasksContainer.appendChild(taskElement);
            });
        }

        // è™•ç†æŒ‡ä»¤è¼¸å…¥
        function handleCommand(event) {
            const input = event.target;
            
            if (event.key === 'Enter') {
                const command = input.value.trim();
                
                if (command) {
                    // æ·»åŠ åˆ°æ­·å²è¨˜éŒ„
                    gameState.commandHistory.push(command);
                    // é™åˆ¶æ­·å²è¨˜éŒ„æ•¸é‡
                    if (gameState.commandHistory.length > 50) {
                        gameState.commandHistory.shift();
                    }
                    // é‡ç½®æ­·å²ç´¢å¼•
                    gameState.historyIndex = -1;
                    
                    executeCommand(command);
                    input.value = '';
                }
            } else if (event.key === 'ArrowUp') {
                event.preventDefault();
                navigateHistory('up', input);
            } else if (event.key === 'ArrowDown') {
                event.preventDefault();
                navigateHistory('down', input);
            }
        }
        
        // ç€è¦½æŒ‡ä»¤æ­·å²
        function navigateHistory(direction, input) {
            if (gameState.commandHistory.length === 0) return;
            
            if (direction === 'up') {
                if (gameState.historyIndex === -1) {
                    gameState.historyIndex = gameState.commandHistory.length - 1;
                } else if (gameState.historyIndex > 0) {
                    gameState.historyIndex--;
                }
            } else if (direction === 'down') {
                if (gameState.historyIndex === -1) {
                    return;
                } else if (gameState.historyIndex < gameState.commandHistory.length - 1) {
                    gameState.historyIndex++;
                } else {
                    gameState.historyIndex = -1;
                    input.value = '';
                    return;
                }
            }
            
            if (gameState.historyIndex >= 0) {
                input.value = gameState.commandHistory[gameState.historyIndex];
                // å°‡æ¸¸æ¨™ç§»åˆ°æœ€å¾Œ
                setTimeout(() => {
                    input.setSelectionRange(input.value.length, input.value.length);
                }, 0);
            }
        }

        // åŸ·è¡ŒæŒ‡ä»¤
        function executeCommand(command) {
            addToTerminal(`git-practice:~$ ${command}`, 'text-white');
            
            const parts = command.split(' ');
            const mainCommand = parts[0];
            
            switch (mainCommand) {
                case 'help':
                    showHelp();
                    break;
                case 'tutorial':
                    showTutorial();
                    break;
                case 'git':
                    handleGitCommand(parts.slice(1));
                    break;
                case 'touch':
                    handleTouchCommand(parts.slice(1));
                    break;
                case 'ls':
                    handleLsCommand();
                    break;
                case 'clear':
                    clearTerminal();
                    break;
                case 'history':
                    showHistory();
                    break;
                default:
                    addToTerminal(`æŒ‡ä»¤ä¸å­˜åœ¨: ${command}`, 'text-red-400');
                    addToTerminal('è¼¸å…¥ "help" æŸ¥çœ‹å¯ç”¨æŒ‡ä»¤', 'text-gray-400');
            }
            
            checkTaskCompletion(command);
        }

        // è™•ç† Git æŒ‡ä»¤
        function handleGitCommand(args) {
            if (args.length === 0) {
                addToTerminal('usage: git <command> [<args>]', 'text-yellow-400');
                return;
            }
            
            const subCommand = args[0];
            
            switch (subCommand) {
                case 'init':
                    handleGitInit();
                    break;
                case 'config':
                    handleGitConfig(args.slice(1));
                    break;
                case 'status':
                    handleGitStatus();
                    break;
                case 'add':
                    handleGitAdd(args.slice(1));
                    break;
                case 'commit':
                    handleGitCommit(args.slice(1));
                    break;
                case 'log':
                    handleGitLog();
                    break;
                case 'branch':
                    handleGitBranch(args.slice(1));
                    break;
                case 'checkout':
                    handleGitCheckout(args.slice(1));
                    break;
                case 'merge':
                    handleGitMerge(args.slice(1));
                    break;
                case 'remote':
                    handleGitRemote(args.slice(1));
                    break;
                case 'push':
                    handleGitPush(args.slice(1));
                    break;
                case 'pull':
                    handleGitPull(args.slice(1));
                    break;
                default:
                    addToTerminal(`git: '${subCommand}' is not a git command.`, 'text-red-400');
            }
        }

        // Git æŒ‡ä»¤å¯¦ä½œ
        function handleGitInit() {
            if (gameState.repository.initialized) {
                addToTerminal('Reinitialized existing Git repository', 'text-yellow-400');
            } else {
                gameState.repository.initialized = true;
                addToTerminal('Initialized empty Git repository in /git-practice/.git/', 'text-green-400');
            }
        }

        function handleGitConfig(args) {
            if (args.length === 0) {
                addToTerminal('usage: git config [--global] <key> <value>', 'text-yellow-400');
                addToTerminal('   or: git config [--global] --list', 'text-yellow-400');
                return;
            }
            
            let isGlobal = false;
            let configArgs = [...args];
            
            if (args[0] === '--global') {
                isGlobal = true;
                configArgs = args.slice(1);
            }
            
            if (configArgs[0] === '--list') {
                addToTerminal('user.name=Your Name', 'text-gray-300');
                addToTerminal('user.email=your@email.com', 'text-gray-300');
                addToTerminal('core.autocrlf=true', 'text-gray-300');
                return;
            }
            
            if (configArgs.length < 2) {
                addToTerminal('usage: git config [--global] <key> <value>', 'text-yellow-400');
                return;
            }
            
            const key = configArgs[0];
            const value = configArgs.slice(1).join(' ').replace(/['"]/g, '');
            const scope = isGlobal ? 'å…¨åŸŸ' : 'æœ¬åœ°';
            
            if (key === 'user.name') {
                addToTerminal(`è¨­å®š${scope}ä½¿ç”¨è€…åç¨±: ${value}`, 'text-green-400');
            } else if (key === 'user.email') {
                addToTerminal(`è¨­å®š${scope}ä½¿ç”¨è€…ä¿¡ç®±: ${value}`, 'text-green-400');
            } else {
                addToTerminal(`è¨­å®š${scope} ${key}: ${value}`, 'text-green-400');
            }
        }

        function handleGitStatus() {
            if (!gameState.repository.initialized) {
                addToTerminal('fatal: not a git repository', 'text-red-400');
                return;
            }
            
            addToTerminal(`On branch ${gameState.repository.currentBranch}`, 'text-white');
            
            const stagedFiles = Object.keys(gameState.repository.staged);
            const unstagedFiles = Object.keys(gameState.repository.files).filter(
                file => !gameState.repository.staged[file]
            );
            
            if (stagedFiles.length > 0) {
                addToTerminal('\nChanges to be committed:', 'text-green-400');
                stagedFiles.forEach(file => {
                    addToTerminal(`  new file:   ${file}`, 'text-green-400');
                });
            }
            
            if (unstagedFiles.length > 0) {
                addToTerminal('\nUntracked files:', 'text-red-400');
                unstagedFiles.forEach(file => {
                    addToTerminal(`  ${file}`, 'text-red-400');
                });
            }
            
            if (stagedFiles.length === 0 && unstagedFiles.length === 0) {
                addToTerminal('nothing to commit, working tree clean', 'text-gray-400');
            }
        }

        function handleGitAdd(args) {
            if (!gameState.repository.initialized) {
                addToTerminal('fatal: not a git repository', 'text-red-400');
                return;
            }
            
            if (args.length === 0) {
                addToTerminal('usage: git add <file>', 'text-yellow-400');
                return;
            }
            
            const target = args[0];
            
            if (target === '.') {
                Object.keys(gameState.repository.files).forEach(file => {
                    gameState.repository.staged[file] = true;
                });
                addToTerminal('å·²å°‡æ‰€æœ‰æª”æ¡ˆåŠ å…¥æš«å­˜å€', 'text-green-400');
            } else if (gameState.repository.files[target]) {
                gameState.repository.staged[target] = true;
                addToTerminal(`å·²å°‡ ${target} åŠ å…¥æš«å­˜å€`, 'text-green-400');
            } else {
                addToTerminal(`pathspec '${target}' did not match any files`, 'text-red-400');
            }
        }

        function handleGitCommit(args) {
            if (!gameState.repository.initialized) {
                addToTerminal('fatal: not a git repository', 'text-red-400');
                return;
            }
            
            const stagedFiles = Object.keys(gameState.repository.staged);
            if (stagedFiles.length === 0) {
                addToTerminal('nothing to commit', 'text-yellow-400');
                return;
            }
            
            let message = 'Initial commit';
            if (args.includes('-m') && args.length > 2) {
                const messageIndex = args.indexOf('-m') + 1;
                message = args.slice(messageIndex).join(' ').replace(/['"]/g, '');
            }
            
            const commitId = Math.random().toString(36).substr(2, 7);
            gameState.repository.commits.push({
                id: commitId,
                message: message,
                files: [...stagedFiles],
                branch: gameState.repository.currentBranch
            });
            
            gameState.repository.staged = {};
            addToTerminal(`[${gameState.repository.currentBranch} ${commitId}] ${message}`, 'text-green-400');
            addToTerminal(`${stagedFiles.length} file(s) changed`, 'text-gray-400');
        }

        function handleGitLog() {
            if (!gameState.repository.initialized) {
                addToTerminal('fatal: not a git repository', 'text-red-400');
                return;
            }
            
            if (gameState.repository.commits.length === 0) {
                addToTerminal('fatal: your current branch does not have any commits yet', 'text-red-400');
                return;
            }
            
            gameState.repository.commits.slice().reverse().forEach(commit => {
                addToTerminal(`commit ${commit.id}`, 'text-yellow-400');
                addToTerminal(`    ${commit.message}`, 'text-white');
                addToTerminal('', 'text-white');
            });
        }

        function handleGitBranch(args) {
            if (!gameState.repository.initialized) {
                addToTerminal('fatal: not a git repository', 'text-red-400');
                return;
            }
            
            if (args.length === 0) {
                gameState.repository.branches.forEach(branch => {
                    const prefix = branch === gameState.repository.currentBranch ? '* ' : '  ';
                    const color = branch === gameState.repository.currentBranch ? 'text-green-400' : 'text-white';
                    addToTerminal(`${prefix}${branch}`, color);
                });
            } else {
                const newBranch = args[0];
                if (!gameState.repository.branches.includes(newBranch)) {
                    gameState.repository.branches.push(newBranch);
                    addToTerminal(`å·²å‰µå»ºåˆ†æ”¯ '${newBranch}'`, 'text-green-400');
                } else {
                    addToTerminal(`fatal: A branch named '${newBranch}' already exists.`, 'text-red-400');
                }
            }
        }

        function handleGitCheckout(args) {
            if (!gameState.repository.initialized) {
                addToTerminal('fatal: not a git repository', 'text-red-400');
                return;
            }
            
            if (args.length === 0) {
                addToTerminal('usage: git checkout <branch>', 'text-yellow-400');
                return;
            }
            
            const targetBranch = args[0];
            if (gameState.repository.branches.includes(targetBranch)) {
                gameState.repository.currentBranch = targetBranch;
                addToTerminal(`Switched to branch '${targetBranch}'`, 'text-green-400');
            } else {
                addToTerminal(`error: pathspec '${targetBranch}' did not match any file(s) known to git`, 'text-red-400');
            }
        }

        function handleGitMerge(args) {
            if (!gameState.repository.initialized) {
                addToTerminal('fatal: not a git repository', 'text-red-400');
                return;
            }
            
            if (args.length === 0) {
                addToTerminal('usage: git merge <branch>', 'text-yellow-400');
                return;
            }
            
            const sourceBranch = args[0];
            
            if (sourceBranch === gameState.repository.currentBranch) {
                addToTerminal('Already up to date.', 'text-gray-400');
                return;
            }
            
            if (!gameState.repository.branches.includes(sourceBranch)) {
                addToTerminal(`merge: ${sourceBranch} - not something we can merge`, 'text-red-400');
                return;
            }
            
            if (gameState.repository.commits.length === 0) {
                addToTerminal('fatal: refusing to merge unrelated histories', 'text-red-400');
                return;
            }
            
            // æ¨¡æ“¬å¿«é€²åˆä½µæˆ–ä¸‰æ–¹åˆä½µ
            const hasCommitsInSource = gameState.repository.commits.some(c => c.branch === sourceBranch);
            
            if (hasCommitsInSource) {
                addToTerminal(`Merge made by the 'recursive' strategy.`, 'text-green-400');
                
                // å‰µå»ºåˆä½µæäº¤
                const commitId = Math.random().toString(36).substr(2, 7);
                gameState.repository.commits.push({
                    id: commitId,
                    message: `Merge branch '${sourceBranch}'`,
                    files: [],
                    branch: gameState.repository.currentBranch
                });
                
                addToTerminal(`å·²å°‡ '${sourceBranch}' åˆä½µåˆ° '${gameState.repository.currentBranch}'`, 'text-green-400');
            } else {
                addToTerminal('Already up to date.', 'text-gray-400');
            }
        }

        function handleGitRemote(args) {
            if (args.length === 0) {
                Object.keys(gameState.repository.remotes).forEach(remote => {
                    addToTerminal(remote, 'text-white');
                });
                return;
            }
            
            if (args[0] === 'add' && args.length >= 3) {
                const remoteName = args[1];
                const remoteUrl = args[2];
                gameState.repository.remotes[remoteName] = remoteUrl;
                addToTerminal(`å·²æ·»åŠ é ç«¯å€‰åº« '${remoteName}': ${remoteUrl}`, 'text-green-400');
            } else if (args[0] === '-v') {
                Object.entries(gameState.repository.remotes).forEach(([name, url]) => {
                    addToTerminal(`${name}\t${url} (fetch)`, 'text-white');
                    addToTerminal(`${name}\t${url} (push)`, 'text-white');
                });
            }
        }

        function handleGitPush(args) {
            if (Object.keys(gameState.repository.remotes).length === 0) {
                addToTerminal('fatal: No configured push destination.', 'text-red-400');
                return;
            }
            
            if (gameState.repository.commits.length === 0) {
                addToTerminal('error: src refspec main does not match any', 'text-red-400');
                return;
            }
            
            addToTerminal('Enumerating objects: 3, done.', 'text-white');
            addToTerminal('Counting objects: 100% (3/3), done.', 'text-white');
            addToTerminal('Writing objects: 100% (3/3), 242 bytes | 242.00 KiB/s, done.', 'text-white');
            addToTerminal('Total 3 (delta 0), reused 0 (delta 0)', 'text-white');
            addToTerminal(`To ${Object.values(gameState.repository.remotes)[0]}`, 'text-green-400');
            addToTerminal(` * [new branch]      ${gameState.repository.currentBranch} -> ${gameState.repository.currentBranch}`, 'text-green-400');
        }

        function handleGitPull(args) {
            if (Object.keys(gameState.repository.remotes).length === 0) {
                addToTerminal('fatal: No remote repository specified.', 'text-red-400');
                return;
            }
            
            addToTerminal('Already up to date.', 'text-gray-400');
        }

        // å…¶ä»–æŒ‡ä»¤
        function handleTouchCommand(args) {
            if (args.length === 0) {
                addToTerminal('usage: touch <filename>', 'text-yellow-400');
                return;
            }
            
            const filename = args[0];
            gameState.repository.files[filename] = '';
            addToTerminal(`å·²å‰µå»ºæª”æ¡ˆ: ${filename}`, 'text-green-400');
        }

        function handleLsCommand() {
            const files = Object.keys(gameState.repository.files);
            if (files.length === 0) {
                addToTerminal('ç›®éŒ„ç‚ºç©º', 'text-gray-400');
            } else {
                files.forEach(file => {
                    addToTerminal(file, 'text-blue-400');
                });
            }
        }

        // æª¢æŸ¥ä»»å‹™å®Œæˆ
        function checkTaskCompletion(command) {
            if (gameState.currentLesson === 0) return;
            
            const taskMappings = {
                1: {
                    'git init': 1,
                    'git config --global user.name': 2,
                    'git config --global user.email': 3,
                    'git status': 4
                },
                2: {
                    'touch': 1,
                    'git add': 2,
                    'git commit': 3,
                    'git log': 4
                },
                3: {
                    'git branch': [1, 2],
                    'git checkout': 3,
                    'git merge': 4
                },
                4: {
                    'git remote add': 1,
                    'git remote -v': 2,
                    'git push': 3,
                    'git pull': 4
                }
            };
            
            const currentMappings = taskMappings[gameState.currentLesson];
            if (!currentMappings) return;
            
            Object.entries(currentMappings).forEach(([cmd, taskIds]) => {
                if (command.includes(cmd)) {
                    const ids = Array.isArray(taskIds) ? taskIds : [taskIds];
                    ids.forEach(taskId => {
                        const task = gameState.tasks.find(t => t.id === taskId);
                        if (task && !task.completed) {
                            task.completed = true;
                            addToTerminal(`âœ… ä»»å‹™å®Œæˆ: ${task.text}`, 'text-green-400');
                        }
                    });
                }
            });
            
            updateTaskList();
            checkLessonCompletion();
        }

        // æª¢æŸ¥é—œå¡å®Œæˆ
        function checkLessonCompletion() {
            const allCompleted = gameState.tasks.every(task => task.completed);
            
            if (allCompleted && !gameState.completedLessons.includes(gameState.currentLesson)) {
                gameState.completedLessons.push(gameState.currentLesson);
                addToTerminal(`ğŸ‰ æ­å–œï¼ç¬¬${gameState.currentLesson}é—œå®Œæˆï¼`, 'text-yellow-400');
                
                if (gameState.currentLesson < 4) {
                    addToTerminal(`å¯ä»¥ç¹¼çºŒæŒ‘æˆ°ç¬¬${gameState.currentLesson + 1}é—œï¼`, 'text-blue-400');
                } else {
                    addToTerminal('ğŸ† æ‰€æœ‰é—œå¡å®Œæˆï¼ä½ å·²ç¶“æŒæ¡äº† Git çš„åŸºæœ¬æ“ä½œï¼', 'text-yellow-400');
                }
                
                updateProgress();
            }
        }

        // æ›´æ–°é€²åº¦
        function updateProgress() {
            const progress = (gameState.completedLessons.length / 4) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('progress-text').textContent = `${gameState.completedLessons.length}/4 é—œå¡å®Œæˆ`;
        }

        // è¼”åŠ©åŠŸèƒ½
        function showHelp() {
            addToTerminal('å¯ç”¨æŒ‡ä»¤:', 'text-yellow-400');
            addToTerminal('  help          - é¡¯ç¤ºæ­¤èªªæ˜', 'text-gray-300');
            addToTerminal('  tutorial      - é–‹å§‹æ•™å­¸', 'text-gray-300');
            addToTerminal('  clear         - æ¸…é™¤çµ‚ç«¯æ©Ÿ', 'text-gray-300');
            addToTerminal('  history       - é¡¯ç¤ºæŒ‡ä»¤æ­·å²', 'text-gray-300');
            addToTerminal('  ls            - åˆ—å‡ºæª”æ¡ˆ', 'text-gray-300');
            addToTerminal('  touch <file>  - å‰µå»ºæª”æ¡ˆ', 'text-gray-300');
            addToTerminal('', 'text-white');
            addToTerminal('Git æŒ‡ä»¤:', 'text-yellow-400');
            addToTerminal('  git init                     - åˆå§‹åŒ–å€‰åº«', 'text-gray-300');
            addToTerminal('  git config --global user.name - è¨­å®šä½¿ç”¨è€…åç¨±', 'text-gray-300');
            addToTerminal('  git status                   - æŸ¥çœ‹ç‹€æ…‹', 'text-gray-300');
            addToTerminal('  git add <file>               - åŠ å…¥æš«å­˜å€', 'text-gray-300');
            addToTerminal('  git commit -m "message"      - æäº¤è®Šæ›´', 'text-gray-300');
            addToTerminal('  git log                      - æŸ¥çœ‹æ­·å²', 'text-gray-300');
            addToTerminal('  git branch <name>            - å‰µå»ºåˆ†æ”¯', 'text-gray-300');
            addToTerminal('  git checkout <branch>        - åˆ‡æ›åˆ†æ”¯', 'text-gray-300');
            addToTerminal('', 'text-white');
            addToTerminal('å¿«æ·éµ:', 'text-yellow-400');
            addToTerminal('  â†‘ / â†“         - ç€è¦½æŒ‡ä»¤æ­·å²', 'text-gray-300');
        }

        function showTutorial() {
            addToTerminal('ğŸ¯ Git ç·´ç¿’æ•™å­¸', 'text-yellow-400');
            addToTerminal('1. é¸æ“‡å·¦å´çš„é—œå¡é–‹å§‹å­¸ç¿’', 'text-gray-300');
            addToTerminal('2. é–±è®€æ•™å­¸å…§å®¹å’Œä»»å‹™æ¸…å–®', 'text-gray-300');
            addToTerminal('3. åœ¨çµ‚ç«¯æ©Ÿä¸­è¼¸å…¥æŒ‡ä»¤ç·´ç¿’', 'text-gray-300');
            addToTerminal('4. å®Œæˆæ‰€æœ‰ä»»å‹™è§£é–ä¸‹ä¸€é—œ', 'text-gray-300');
            addToTerminal('', 'text-white');
            addToTerminal('ğŸ’¡ æç¤ºï¼šå¯ä»¥ä½¿ç”¨å¿«é€ŸæŒ‡ä»¤æŒ‰éˆ•ï¼', 'text-blue-400');
            addToTerminal('ğŸ’¡ æç¤ºï¼šä½¿ç”¨ â†‘â†“ æ–¹å‘éµç€è¦½æŒ‡ä»¤æ­·å²ï¼', 'text-blue-400');
        }
        
        function showHistory() {
            if (gameState.commandHistory.length === 0) {
                addToTerminal('æ²’æœ‰æŒ‡ä»¤æ­·å²è¨˜éŒ„', 'text-gray-400');
                return;
            }
            
            addToTerminal('æŒ‡ä»¤æ­·å²è¨˜éŒ„:', 'text-yellow-400');
            gameState.commandHistory.forEach((cmd, index) => {
                addToTerminal(`  ${index + 1}  ${cmd}`, 'text-gray-300');
            });
        }

        function addToTerminal(text, className = 'text-white') {
            const output = document.getElementById('terminal-output');
            const line = document.createElement('div');
            line.className = className + ' slide-in';
            line.textContent = text;
            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
        }

        function clearTerminal() {
            document.getElementById('terminal-output').innerHTML = `
                <div class="text-green-400">Git ç·´ç¿’æ¨¡æ“¬å™¨ v1.0</div>
                <div class="text-gray-400">è¼¸å…¥ 'help' æŸ¥çœ‹å¯ç”¨æŒ‡ä»¤</div>
                <div class="text-gray-400">è¼¸å…¥ 'tutorial' é–‹å§‹æ•™å­¸</div>
                <div class="mt-2"></div>
            `;
        }

        function insertCommand(command) {
            document.getElementById('command-input').value = command;
            document.getElementById('command-input').focus();
        }

        // åˆå§‹åŒ–
        document.getElementById('command-input').focus();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'988288e1d31b8098',t:'MTc1OTM5MDY0OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
