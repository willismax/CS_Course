<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¼”ç®—æ³•è¦–è¦ºåŒ–å·¥å…·</title>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100%;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }
        
        .algorithm-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .algo-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            background: #4299e1;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .algo-btn:hover {
            background: #3182ce;
            transform: translateY(-2px);
        }
        
        .algo-btn.active {
            background: #38a169;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 15px;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            background: #48bb78;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: #38a169;
        }
        
        .control-btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
        }
        
        input[type="range"] {
            width: 120px;
        }
        
        .visualization-area {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .array-container {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .array-element {
            width: 50px;
            height: 50px;
            background: #4299e1;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .array-element.comparing {
            background: #f56565;
            transform: scale(1.1);
        }
        
        .array-element.swapping {
            background: #ed8936;
            transform: scale(1.2);
            z-index: 10;
            position: relative;
        }
        
        .array-element.moving-up {
            animation: moveUp 0.6s ease-in-out;
            z-index: 15;
        }
        
        .array-element.moving-down {
            animation: moveDown 0.6s ease-in-out;
            z-index: 15;
        }
        
        @keyframes moveUp {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-60px); }
            100% { transform: translateY(0px); }
        }
        
        @keyframes moveDown {
            0% { transform: translateY(0px); }
            50% { transform: translateY(60px); }
            100% { transform: translateY(0px); }
        }
        
        .array-element.slide-left {
            animation: slideLeft 0.8s ease-in-out;
            z-index: 12;
        }
        
        .array-element.slide-right {
            animation: slideRight 0.8s ease-in-out;
            z-index: 12;
        }
        
        @keyframes slideLeft {
            0% { transform: translateX(0px); }
            50% { transform: translateX(-55px) translateY(-30px) scale(1.1); }
            100% { transform: translateX(0px); }
        }
        
        @keyframes slideRight {
            0% { transform: translateX(0px); }
            50% { transform: translateX(55px) translateY(-30px) scale(1.1); }
            100% { transform: translateX(0px); }
        }
        
        .array-element.sorted {
            background: #48bb78;
        }
        
        .array-element.pivot {
            background: #9f7aea;
            transform: scale(1.15);
        }
        
        .info-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 5px solid #4299e1;
        }
        
        .step-info {
            font-size: 16px;
            margin-bottom: 10px;
            color: #2d3748;
        }
        
        .complexity-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .complexity-card {
            background: #edf2f7;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .fibonacci-container {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .fib-input {
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            width: 100px;
            text-align: center;
        }
        
        .fib-result {
            font-size: 24px;
            font-weight: bold;
            color: #2d3748;
        }
        
        .fib-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            width: 100%;
            max-width: 600px;
        }
        
        .fib-method {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
        }
        
        .search-container {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .search-input {
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            width: 100px;
            text-align: center;
        }
        
        .search-result {
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
        }
        
        .code-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 5px solid #9f7aea;
        }
        
        .code-panel h2 {
            margin-top: 0;
            color: #4a5568;
            text-align: center;
        }
        
        .language-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .tab-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            background: #e2e8f0;
            color: #4a5568;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .tab-btn:hover {
            background: #cbd5e0;
        }
        
        .tab-btn.active {
            background: #9f7aea;
            color: white;
        }
        
        .code-content {
            background: #2d3748;
            border-radius: 10px;
            padding: 20px;
            overflow-x: auto;
        }
        
        .code-content pre {
            margin: 0;
            color: #e2e8f0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .code-content code {
            color: #e2e8f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” æ¼”ç®—æ³•è¦–è¦ºåŒ–å·¥å…·</h1>
        
        <div class="algorithm-selector">
            <button class="algo-btn active" onclick="selectAlgorithm('selection')">é¸æ“‡æ’åº</button>
            <button class="algo-btn" onclick="selectAlgorithm('insertion')">æ’å…¥æ’åº</button>
            <button class="algo-btn" onclick="selectAlgorithm('bubble')">æ³¡æ²«æ’åº</button>
            <button class="algo-btn" onclick="selectAlgorithm('quick')">å¿«é€Ÿæ’åº</button>
            <button class="algo-btn" onclick="selectAlgorithm('binary')">äºŒå…ƒæœå°‹</button>
            <button class="algo-btn" onclick="selectAlgorithm('fibonacci')">å‹•æ…‹è¦åŠƒ (Fibonacci)</button>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <button class="control-btn" onclick="generateArray()">ç”¢ç”Ÿæ–°é™£åˆ—</button>
                <button class="control-btn" onclick="startSort()" id="startBtn">é–‹å§‹æ’åº</button>
                <button class="control-btn" onclick="pauseSort()" id="pauseBtn" style="display: none;">æš«åœ</button>
                <button class="control-btn" onclick="resetArray()">é‡ç½®</button>
            </div>
            <div class="control-group">
                <label>é™£åˆ—å¤§å°:</label>
                <input type="range" id="arraySize" min="5" max="20" value="10" onchange="generateArray()">
                <span id="sizeValue">10</span>
            </div>
            <div class="control-group">
                <label>é€Ÿåº¦:</label>
                <input type="range" id="speed" min="50" max="1000" value="300">
                <span>æ…¢ â† â†’ å¿«</span>
            </div>
        </div>
        
        <div class="visualization-area">
            <div class="array-container" id="arrayContainer"></div>
            
            <div class="search-container" id="searchContainer">
                <div class="control-group">
                    <label>æœå°‹ç›®æ¨™:</label>
                    <input type="number" class="search-input" id="searchTarget" placeholder="è¼¸å…¥æ•¸å­—">
                    <button class="control-btn" onclick="startBinarySearch()">é–‹å§‹æœå°‹</button>
                </div>
                <div class="search-result" id="searchResult"></div>
            </div>
            
            <div class="fibonacci-container" id="fibonacciContainer">
                <div class="control-group">
                    <label>è¨ˆç®— Fibonacci æ•¸åˆ—ç¬¬</label>
                    <input type="number" class="fib-input" id="fibInput" value="10" min="1" max="40">
                    <label>é …</label>
                    <button class="control-btn" onclick="calculateFibonacci()">è¨ˆç®—</button>
                </div>
                <div class="fib-result" id="fibResult"></div>
                <div class="fib-comparison">
                    <div class="fib-method">
                        <h3>ğŸŒ éè¿´æ–¹æ³•</h3>
                        <div id="recursiveResult">æ™‚é–“: - ms<br>å‘¼å«æ¬¡æ•¸: -</div>
                    </div>
                    <div class="fib-method">
                        <h3>âš¡ å‹•æ…‹è¦åŠƒ</h3>
                        <div id="dpResult">æ™‚é–“: - ms<br>å‘¼å«æ¬¡æ•¸: -</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="info-panel">
            <div class="step-info" id="stepInfo">é¸æ“‡ä¸€å€‹æ¼”ç®—æ³•é–‹å§‹è¦–è¦ºåŒ–</div>
            <div class="complexity-info" id="complexityInfo"></div>
        </div>
        
        <div class="code-panel">
            <h2>ğŸ“ ç¨‹å¼ç¢¼ç¯„ä¾‹</h2>
            <div class="language-tabs">
                <button class="tab-btn active" onclick="showLanguage('python')">Python</button>
                <button class="tab-btn" onclick="showLanguage('c')">C</button>
                <button class="tab-btn" onclick="showLanguage('java')">Java</button>
            </div>
            <div class="code-content" id="codeContent">
                <pre><code id="codeDisplay"></code></pre>
            </div>
        </div>
    </div>

    <script>
        let array = [];
        let originalArray = [];
        let currentAlgorithm = 'selection';
        let isRunning = false;
        let isPaused = false;
        let shouldStop = false;
        let animationSpeed = 300;
        let currentLanguage = 'python';

        // ç¨‹å¼ç¢¼ç¯„ä¾‹è³‡æ–™åº«
        const codeExamples = {
            selection: {
                python: `def selection_sort(arr):
    """é¸æ“‡æ’åºæ³• - Python å¯¦ä½œ"""
    n = len(arr)
    
    for i in range(n - 1):
        # æ‰¾åˆ°æœ€å°å€¼çš„ç´¢å¼•
        min_idx = i
        for j in range(i + 1, n):
            if arr[j] < arr[min_idx]:
                min_idx = j
        
        # äº¤æ›å…ƒç´ 
        arr[i], arr[min_idx] = arr[min_idx], arr[i]
    
    return arr

# ä½¿ç”¨ç¯„ä¾‹
numbers = [64, 34, 25, 12, 22, 11, 90]
sorted_numbers = selection_sort(numbers.copy())
print(f"æ’åºå‰: {numbers}")
print(f"æ’åºå¾Œ: {sorted_numbers}")`,
                c: `#include <stdio.h>

void selection_sort(int arr[], int n) {
    /* é¸æ“‡æ’åºæ³• - C å¯¦ä½œ */
    int i, j, min_idx, temp;
    
    for (i = 0; i < n - 1; i++) {
        // æ‰¾åˆ°æœ€å°å€¼çš„ç´¢å¼•
        min_idx = i;
        for (j = i + 1; j < n; j++) {
            if (arr[j] < arr[min_idx]) {
                min_idx = j;
            }
        }
        
        // äº¤æ›å…ƒç´ 
        temp = arr[min_idx];
        arr[min_idx] = arr[i];
        arr[i] = temp;
    }
}

int main() {
    int arr[] = {64, 34, 25, 12, 22, 11, 90};
    int n = sizeof(arr) / sizeof(arr[0]);
    
    printf("æ’åºå‰: ");
    for (int i = 0; i < n; i++) {
        printf("%d ", arr[i]);
    }
    
    selection_sort(arr, n);
    
    printf("\\næ’åºå¾Œ: ");
    for (int i = 0; i < n; i++) {
        printf("%d ", arr[i]);
    }
    
    return 0;
}`,
                java: `public class SelectionSort {
    /**
     * é¸æ“‡æ’åºæ³• - Java å¯¦ä½œ
     */
    public static void selectionSort(int[] arr) {
        int n = arr.length;
        
        for (int i = 0; i < n - 1; i++) {
            // æ‰¾åˆ°æœ€å°å€¼çš„ç´¢å¼•
            int minIdx = i;
            for (int j = i + 1; j < n; j++) {
                if (arr[j] < arr[minIdx]) {
                    minIdx = j;
                }
            }
            
            // äº¤æ›å…ƒç´ 
            int temp = arr[minIdx];
            arr[minIdx] = arr[i];
            arr[i] = temp;
        }
    }
    
    public static void main(String[] args) {
        int[] numbers = {64, 34, 25, 12, 22, 11, 90};
        
        System.out.print("æ’åºå‰: ");
        for (int num : numbers) {
            System.out.print(num + " ");
        }
        
        selectionSort(numbers);
        
        System.out.print("\\næ’åºå¾Œ: ");
        for (int num : numbers) {
            System.out.print(num + " ");
        }
    }
}`
            },
            insertion: {
                python: `def insertion_sort(arr):
    """æ’å…¥æ’åºæ³• - Python å¯¦ä½œ"""
    for i in range(1, len(arr)):
        key = arr[i]
        j = i - 1
        
        # å°‡å¤§æ–¼ key çš„å…ƒç´ å‘å³ç§»å‹•
        while j >= 0 and arr[j] > key:
            arr[j + 1] = arr[j]
            j -= 1
        
        # æ’å…¥ key åˆ°æ­£ç¢ºä½ç½®
        arr[j + 1] = key
    
    return arr

# ä½¿ç”¨ç¯„ä¾‹
numbers = [64, 34, 25, 12, 22, 11, 90]
sorted_numbers = insertion_sort(numbers.copy())
print(f"æ’åºå‰: {numbers}")
print(f"æ’åºå¾Œ: {sorted_numbers}")`,
                c: `#include <stdio.h>

void insertion_sort(int arr[], int n) {
    /* æ’å…¥æ’åºæ³• - C å¯¦ä½œ */
    int i, key, j;
    
    for (i = 1; i < n; i++) {
        key = arr[i];
        j = i - 1;
        
        /* å°‡å¤§æ–¼ key çš„å…ƒç´ å‘å³ç§»å‹• */
        while (j >= 0 && arr[j] > key) {
            arr[j + 1] = arr[j];
            j = j - 1;
        }
        
        /* æ’å…¥ key åˆ°æ­£ç¢ºä½ç½® */
        arr[j + 1] = key;
    }
}

int main() {
    int arr[] = {64, 34, 25, 12, 22, 11, 90};
    int n = sizeof(arr) / sizeof(arr[0]);
    
    printf("æ’åºå‰: ");
    for (int i = 0; i < n; i++) {
        printf("%d ", arr[i]);
    }
    
    insertion_sort(arr, n);
    
    printf("\\næ’åºå¾Œ: ");
    for (int i = 0; i < n; i++) {
        printf("%d ", arr[i]);
    }
    
    return 0;
}`,
                java: `public class InsertionSort {
    /**
     * æ’å…¥æ’åºæ³• - Java å¯¦ä½œ
     */
    public static void insertionSort(int[] arr) {
        for (int i = 1; i < arr.length; i++) {
            int key = arr[i];
            int j = i - 1;
            
            // å°‡å¤§æ–¼ key çš„å…ƒç´ å‘å³ç§»å‹•
            while (j >= 0 && arr[j] > key) {
                arr[j + 1] = arr[j];
                j = j - 1;
            }
            
            // æ’å…¥ key åˆ°æ­£ç¢ºä½ç½®
            arr[j + 1] = key;
        }
    }
    
    public static void main(String[] args) {
        int[] numbers = {64, 34, 25, 12, 22, 11, 90};
        
        System.out.print("æ’åºå‰: ");
        for (int num : numbers) {
            System.out.print(num + " ");
        }
        
        insertionSort(numbers);
        
        System.out.print("\\næ’åºå¾Œ: ");
        for (int num : numbers) {
            System.out.print(num + " ");
        }
    }
}`
            },
            bubble: {
                python: `def bubble_sort(arr):
    """æ³¡æ²«æ’åºæ³• - Python å¯¦ä½œ"""
    n = len(arr)
    
    for i in range(n - 1):
        swapped = False
        
        for j in range(n - i - 1):
            # æ¯”è¼ƒç›¸é„°å…ƒç´ 
            if arr[j] > arr[j + 1]:
                # äº¤æ›å…ƒç´ 
                arr[j], arr[j + 1] = arr[j + 1], arr[j]
                swapped = True
        
        # å¦‚æœæ²’æœ‰äº¤æ›ç™¼ç”Ÿï¼Œé™£åˆ—å·²æ’åº
        if not swapped:
            break
    
    return arr

# ä½¿ç”¨ç¯„ä¾‹
numbers = [64, 34, 25, 12, 22, 11, 90]
sorted_numbers = bubble_sort(numbers.copy())
print(f"æ’åºå‰: {numbers}")
print(f"æ’åºå¾Œ: {sorted_numbers}")`,
                c: `#include <stdio.h>
#include <stdbool.h>

void bubble_sort(int arr[], int n) {
    /* æ³¡æ²«æ’åºæ³• - C å¯¦ä½œ */
    int i, j, temp;
    bool swapped;
    
    for (i = 0; i < n - 1; i++) {
        swapped = false;
        
        for (j = 0; j < n - i - 1; j++) {
            /* æ¯”è¼ƒç›¸é„°å…ƒç´  */
            if (arr[j] > arr[j + 1]) {
                /* äº¤æ›å…ƒç´  */
                temp = arr[j];
                arr[j] = arr[j + 1];
                arr[j + 1] = temp;
                swapped = true;
            }
        }
        
        /* å¦‚æœæ²’æœ‰äº¤æ›ç™¼ç”Ÿï¼Œé™£åˆ—å·²æ’åº */
        if (!swapped) {
            break;
        }
    }
}

int main() {
    int arr[] = {64, 34, 25, 12, 22, 11, 90};
    int n = sizeof(arr) / sizeof(arr[0]);
    
    printf("æ’åºå‰: ");
    for (int i = 0; i < n; i++) {
        printf("%d ", arr[i]);
    }
    
    bubble_sort(arr, n);
    
    printf("\\næ’åºå¾Œ: ");
    for (int i = 0; i < n; i++) {
        printf("%d ", arr[i]);
    }
    
    return 0;
}`,
                java: `public class BubbleSort {
    /**
     * æ³¡æ²«æ’åºæ³• - Java å¯¦ä½œ
     */
    public static void bubbleSort(int[] arr) {
        int n = arr.length;
        
        for (int i = 0; i < n - 1; i++) {
            boolean swapped = false;
            
            for (int j = 0; j < n - i - 1; j++) {
                // æ¯”è¼ƒç›¸é„°å…ƒç´ 
                if (arr[j] > arr[j + 1]) {
                    // äº¤æ›å…ƒç´ 
                    int temp = arr[j];
                    arr[j] = arr[j + 1];
                    arr[j + 1] = temp;
                    swapped = true;
                }
            }
            
            // å¦‚æœæ²’æœ‰äº¤æ›ç™¼ç”Ÿï¼Œé™£åˆ—å·²æ’åº
            if (!swapped) {
                break;
            }
        }
    }
    
    public static void main(String[] args) {
        int[] numbers = {64, 34, 25, 12, 22, 11, 90};
        
        System.out.print("æ’åºå‰: ");
        for (int num : numbers) {
            System.out.print(num + " ");
        }
        
        bubbleSort(numbers);
        
        System.out.print("\\næ’åºå¾Œ: ");
        for (int num : numbers) {
            System.out.print(num + " ");
        }
    }
}`
            },
            quick: {
                python: `def quick_sort(arr, low=0, high=None):
    """å¿«é€Ÿæ’åºæ³• - Python å¯¦ä½œ"""
    if high is None:
        high = len(arr) - 1
    
    if low < high:
        # åˆ†å‰²é™£åˆ—ä¸¦å–å¾—åŸºæº–é»ä½ç½®
        pi = partition(arr, low, high)
        
        # éè¿´æ’åºåŸºæº–é»å·¦å³å…©å´
        quick_sort(arr, low, pi - 1)
        quick_sort(arr, pi + 1, high)
    
    return arr

def partition(arr, low, high):
    """åˆ†å‰²å‡½æ•¸"""
    pivot = arr[high]  # é¸æ“‡æœ€å¾Œä¸€å€‹å…ƒç´ ä½œç‚ºåŸºæº–é»
    i = low - 1        # è¼ƒå°å…ƒç´ çš„ç´¢å¼•
    
    for j in range(low, high):
        if arr[j] <= pivot:
            i += 1
            arr[i], arr[j] = arr[j], arr[i]
    
    arr[i + 1], arr[high] = arr[high], arr[i + 1]
    return i + 1

# ä½¿ç”¨ç¯„ä¾‹
numbers = [64, 34, 25, 12, 22, 11, 90]
sorted_numbers = quick_sort(numbers.copy())
print(f"æ’åºå‰: {numbers}")
print(f"æ’åºå¾Œ: {sorted_numbers}")`,
                c: `#include <stdio.h>

int partition(int arr[], int low, int high) {
    /* åˆ†å‰²å‡½æ•¸ */
    int pivot = arr[high];  // é¸æ“‡æœ€å¾Œä¸€å€‹å…ƒç´ ä½œç‚ºåŸºæº–é»
    int i = (low - 1);      // è¼ƒå°å…ƒç´ çš„ç´¢å¼•
    int temp;
    
    for (int j = low; j <= high - 1; j++) {
        if (arr[j] <= pivot) {
            i++;
            temp = arr[i];
            arr[i] = arr[j];
            arr[j] = temp;
        }
    }
    
    temp = arr[i + 1];
    arr[i + 1] = arr[high];
    arr[high] = temp;
    
    return (i + 1);
}

void quick_sort(int arr[], int low, int high) {
    /* å¿«é€Ÿæ’åºæ³• - C å¯¦ä½œ */
    if (low < high) {
        // åˆ†å‰²é™£åˆ—ä¸¦å–å¾—åŸºæº–é»ä½ç½®
        int pi = partition(arr, low, high);
        
        // éè¿´æ’åºåŸºæº–é»å·¦å³å…©å´
        quick_sort(arr, low, pi - 1);
        quick_sort(arr, pi + 1, high);
    }
}

int main() {
    int arr[] = {64, 34, 25, 12, 22, 11, 90};
    int n = sizeof(arr) / sizeof(arr[0]);
    
    printf("æ’åºå‰: ");
    for (int i = 0; i < n; i++) {
        printf("%d ", arr[i]);
    }
    
    quick_sort(arr, 0, n - 1);
    
    printf("\\næ’åºå¾Œ: ");
    for (int i = 0; i < n; i++) {
        printf("%d ", arr[i]);
    }
    
    return 0;
}`,
                java: `public class QuickSort {
    /**
     * å¿«é€Ÿæ’åºæ³• - Java å¯¦ä½œ
     */
    public static void quickSort(int[] arr, int low, int high) {
        if (low < high) {
            // åˆ†å‰²é™£åˆ—ä¸¦å–å¾—åŸºæº–é»ä½ç½®
            int pi = partition(arr, low, high);
            
            // éè¿´æ’åºåŸºæº–é»å·¦å³å…©å´
            quickSort(arr, low, pi - 1);
            quickSort(arr, pi + 1, high);
        }
    }
    
    /**
     * åˆ†å‰²å‡½æ•¸
     */
    static int partition(int[] arr, int low, int high) {
        int pivot = arr[high];  // é¸æ“‡æœ€å¾Œä¸€å€‹å…ƒç´ ä½œç‚ºåŸºæº–é»
        int i = (low - 1);      // è¼ƒå°å…ƒç´ çš„ç´¢å¼•
        
        for (int j = low; j < high; j++) {
            if (arr[j] <= pivot) {
                i++;
                
                // äº¤æ›å…ƒç´ 
                int temp = arr[i];
                arr[i] = arr[j];
                arr[j] = temp;
            }
        }
        
        // äº¤æ›åŸºæº–é»åˆ°æ­£ç¢ºä½ç½®
        int temp = arr[i + 1];
        arr[i + 1] = arr[high];
        arr[high] = temp;
        
        return i + 1;
    }
    
    public static void main(String[] args) {
        int[] numbers = {64, 34, 25, 12, 22, 11, 90};
        
        System.out.print("æ’åºå‰: ");
        for (int num : numbers) {
            System.out.print(num + " ");
        }
        
        quickSort(numbers, 0, numbers.length - 1);
        
        System.out.print("\\næ’åºå¾Œ: ");
        for (int num : numbers) {
            System.out.print(num + " ");
        }
    }
}`
            },
            binary: {
                python: `def binary_search(arr, target):
    """äºŒå…ƒæœå°‹æ³• - Python å¯¦ä½œ"""
    left = 0
    right = len(arr) - 1
    
    while left <= right:
        mid = (left + right) // 2
        
        if arr[mid] == target:
            return mid  # æ‰¾åˆ°ç›®æ¨™ï¼Œå›å‚³ç´¢å¼•
        elif arr[mid] < target:
            left = mid + 1  # æœå°‹å³åŠéƒ¨
        else:
            right = mid - 1  # æœå°‹å·¦åŠéƒ¨
    
    return -1  # æœªæ‰¾åˆ°ç›®æ¨™

# ä½¿ç”¨ç¯„ä¾‹
sorted_numbers = [11, 12, 22, 25, 34, 64, 90]
target = 25

result = binary_search(sorted_numbers, target)
if result != -1:
    print(f"æ‰¾åˆ° {target} åœ¨ç´¢å¼• {result}")
else:
    print(f"æœªæ‰¾åˆ° {target}")

# æœå°‹æ‰€æœ‰å…ƒç´ 
for num in [22, 50, 90]:
    idx = binary_search(sorted_numbers, num)
    print(f"æœå°‹ {num}: {'æ‰¾åˆ°åœ¨ç´¢å¼• ' + str(idx) if idx != -1 else 'æœªæ‰¾åˆ°'}")`,
                c: `#include <stdio.h>

int binary_search(int arr[], int n, int target) {
    /* äºŒå…ƒæœå°‹æ³• - C å¯¦ä½œ */
    int left = 0;
    int right = n - 1;
    
    while (left <= right) {
        int mid = left + (right - left) / 2;
        
        if (arr[mid] == target) {
            return mid;  // æ‰¾åˆ°ç›®æ¨™ï¼Œå›å‚³ç´¢å¼•
        }
        else if (arr[mid] < target) {
            left = mid + 1;  // æœå°‹å³åŠéƒ¨
        }
        else {
            right = mid - 1;  // æœå°‹å·¦åŠéƒ¨
        }
    }
    
    return -1;  // æœªæ‰¾åˆ°ç›®æ¨™
}

int main() {
    int arr[] = {11, 12, 22, 25, 34, 64, 90};
    int n = sizeof(arr) / sizeof(arr[0]);
    int target = 25;
    
    printf("é™£åˆ—: ");
    for (int i = 0; i < n; i++) {
        printf("%d ", arr[i]);
    }
    
    int result = binary_search(arr, n, target);
    
    if (result != -1) {
        printf("\\næ‰¾åˆ° %d åœ¨ç´¢å¼• %d\\n", target, result);
    } else {
        printf("\\næœªæ‰¾åˆ° %d\\n", target);
    }
    
    return 0;
}`,
                java: `public class BinarySearch {
    /**
     * äºŒå…ƒæœå°‹æ³• - Java å¯¦ä½œ
     */
    public static int binarySearch(int[] arr, int target) {
        int left = 0;
        int right = arr.length - 1;
        
        while (left <= right) {
            int mid = left + (right - left) / 2;
            
            if (arr[mid] == target) {
                return mid;  // æ‰¾åˆ°ç›®æ¨™ï¼Œå›å‚³ç´¢å¼•
            }
            else if (arr[mid] < target) {
                left = mid + 1;  // æœå°‹å³åŠéƒ¨
            }
            else {
                right = mid - 1;  // æœå°‹å·¦åŠéƒ¨
            }
        }
        
        return -1;  // æœªæ‰¾åˆ°ç›®æ¨™
    }
    
    public static void main(String[] args) {
        int[] sortedNumbers = {11, 12, 22, 25, 34, 64, 90};
        int target = 25;
        
        System.out.print("é™£åˆ—: ");
        for (int num : sortedNumbers) {
            System.out.print(num + " ");
        }
        
        int result = binarySearch(sortedNumbers, target);
        
        if (result != -1) {
            System.out.println("\\næ‰¾åˆ° " + target + " åœ¨ç´¢å¼• " + result);
        } else {
            System.out.println("\\næœªæ‰¾åˆ° " + target);
        }
        
        // æœå°‹å¤šå€‹ç›®æ¨™
        int[] targets = {22, 50, 90};
        for (int t : targets) {
            int idx = binarySearch(sortedNumbers, t);
            System.out.println("æœå°‹ " + t + ": " + 
                (idx != -1 ? "æ‰¾åˆ°åœ¨ç´¢å¼• " + idx : "æœªæ‰¾åˆ°"));
        }
    }
}`
            },
            fibonacci: {
                python: `def fibonacci_recursive(n):
    """éè¿´ç‰ˆæœ¬ Fibonacci - Python å¯¦ä½œ"""
    if n <= 1:
        return n
    return fibonacci_recursive(n - 1) + fibonacci_recursive(n - 2)

def fibonacci_dp(n):
    """å‹•æ…‹è¦åŠƒç‰ˆæœ¬ Fibonacci - Python å¯¦ä½œ"""
    if n <= 1:
        return n
    
    # å»ºç«‹ DP è¡¨æ ¼
    dp = [0] * (n + 1)
    dp[1] = 1
    
    for i in range(2, n + 1):
        dp[i] = dp[i - 1] + dp[i - 2]
    
    return dp[n]

def fibonacci_optimized(n):
    """ç©ºé–“å„ªåŒ–ç‰ˆæœ¬ - åªä½¿ç”¨å…©å€‹è®Šæ•¸"""
    if n <= 1:
        return n
    
    a, b = 0, 1
    for i in range(2, n + 1):
        a, b = b, a + b
    
    return b

# ä½¿ç”¨ç¯„ä¾‹
n = 10
print(f"Fibonacci({n}):")
print(f"éè¿´ç‰ˆæœ¬: {fibonacci_recursive(n)}")
print(f"å‹•æ…‹è¦åŠƒ: {fibonacci_dp(n)}")
print(f"å„ªåŒ–ç‰ˆæœ¬: {fibonacci_optimized(n)}")

# æ¯”è¼ƒæ•ˆèƒ½
import time
n = 35
start = time.time()
result1 = fibonacci_recursive(n)
time1 = time.time() - start

start = time.time()
result2 = fibonacci_dp(n)
time2 = time.time() - start

print(f"\\næ•ˆèƒ½æ¯”è¼ƒ (n={n}):")
print(f"éè¿´: {time1:.4f}ç§’")
print(f"å‹•æ…‹è¦åŠƒ: {time2:.4f}ç§’")`,
                c: `#include <stdio.h>
#include <time.h>

long long fibonacci_recursive(int n) {
    /* éè¿´ç‰ˆæœ¬ Fibonacci - C å¯¦ä½œ */
    if (n <= 1) {
        return n;
    }
    return fibonacci_recursive(n - 1) + fibonacci_recursive(n - 2);
}

long long fibonacci_dp(int n) {
    /* å‹•æ…‹è¦åŠƒç‰ˆæœ¬ Fibonacci - C å¯¦ä½œ */
    if (n <= 1) {
        return n;
    }
    
    long long dp[n + 1];
    dp[0] = 0;
    dp[1] = 1;
    
    for (int i = 2; i <= n; i++) {
        dp[i] = dp[i - 1] + dp[i - 2];
    }
    
    return dp[n];
}

long long fibonacci_optimized(int n) {
    /* ç©ºé–“å„ªåŒ–ç‰ˆæœ¬ - åªä½¿ç”¨å…©å€‹è®Šæ•¸ */
    if (n <= 1) {
        return n;
    }
    
    long long a = 0, b = 1, temp;
    for (int i = 2; i <= n; i++) {
        temp = a + b;
        a = b;
        b = temp;
    }
    
    return b;
}

int main() {
    int n = 10;
    
    printf("Fibonacci(%d):\\n", n);
    printf("éè¿´ç‰ˆæœ¬: %lld\\n", fibonacci_recursive(n));
    printf("å‹•æ…‹è¦åŠƒ: %lld\\n", fibonacci_dp(n));
    printf("å„ªåŒ–ç‰ˆæœ¬: %lld\\n", fibonacci_optimized(n));
    
    // æ•ˆèƒ½æ¯”è¼ƒ
    n = 40;
    clock_t start, end;
    
    start = clock();
    long long result1 = fibonacci_recursive(n);
    end = clock();
    double time1 = ((double)(end - start)) / CLOCKS_PER_SEC;
    
    start = clock();
    long long result2 = fibonacci_dp(n);
    end = clock();
    double time2 = ((double)(end - start)) / CLOCKS_PER_SEC;
    
    printf("\\næ•ˆèƒ½æ¯”è¼ƒ (n=%d):\\n", n);
    printf("éè¿´: %.4fç§’\\n", time1);
    printf("å‹•æ…‹è¦åŠƒ: %.4fç§’\\n", time2);
    
    return 0;
}`,
                java: `public class Fibonacci {
    /**
     * éè¿´ç‰ˆæœ¬ Fibonacci - Java å¯¦ä½œ
     */
    public static long fibonacciRecursive(int n) {
        if (n <= 1) {
            return n;
        }
        return fibonacciRecursive(n - 1) + fibonacciRecursive(n - 2);
    }
    
    /**
     * å‹•æ…‹è¦åŠƒç‰ˆæœ¬ Fibonacci - Java å¯¦ä½œ
     */
    public static long fibonacciDP(int n) {
        if (n <= 1) {
            return n;
        }
        
        long[] dp = new long[n + 1];
        dp[0] = 0;
        dp[1] = 1;
        
        for (int i = 2; i <= n; i++) {
            dp[i] = dp[i - 1] + dp[i - 2];
        }
        
        return dp[n];
    }
    
    /**
     * ç©ºé–“å„ªåŒ–ç‰ˆæœ¬ - åªä½¿ç”¨å…©å€‹è®Šæ•¸
     */
    public static long fibonacciOptimized(int n) {
        if (n <= 1) {
            return n;
        }
        
        long a = 0, b = 1;
        for (int i = 2; i <= n; i++) {
            long temp = a + b;
            a = b;
            b = temp;
        }
        
        return b;
    }
    
    public static void main(String[] args) {
        int n = 10;
        
        System.out.println("Fibonacci(" + n + "):");
        System.out.println("éè¿´ç‰ˆæœ¬: " + fibonacciRecursive(n));
        System.out.println("å‹•æ…‹è¦åŠƒ: " + fibonacciDP(n));
        System.out.println("å„ªåŒ–ç‰ˆæœ¬: " + fibonacciOptimized(n));
        
        // æ•ˆèƒ½æ¯”è¼ƒ
        n = 40;
        long start, end;
        
        start = System.nanoTime();
        long result1 = fibonacciRecursive(n);
        end = System.nanoTime();
        double time1 = (end - start) / 1_000_000_000.0;
        
        start = System.nanoTime();
        long result2 = fibonacciDP(n);
        end = System.nanoTime();
        double time2 = (end - start) / 1_000_000_000.0;
        
        System.out.println("\\næ•ˆèƒ½æ¯”è¼ƒ (n=" + n + "):");
        System.out.printf("éè¿´: %.4fç§’%n", time1);
        System.out.printf("å‹•æ…‹è¦åŠƒ: %.4fç§’%n", time2);
    }
}`
            }
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            generateArray();
            updateComplexityInfo();
            updateCodeDisplay();
        });

        function selectAlgorithm(algo) {
            // åœæ­¢ç•¶å‰é‹è¡Œçš„æ’åº
            stopSort();
            
            currentAlgorithm = algo;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.algo-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // é¡¯ç¤º/éš±è—ç›¸æ‡‰çš„å®¹å™¨
            document.getElementById('searchContainer').style.display = algo === 'binary' ? 'flex' : 'none';
            document.getElementById('fibonacciContainer').style.display = algo === 'fibonacci' ? 'flex' : 'none';
            document.getElementById('arrayContainer').style.display = algo === 'fibonacci' ? 'none' : 'flex';
            
            // æ›´æ–°æ§åˆ¶æŒ‰éˆ•
            const startBtn = document.getElementById('startBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            
            if (algo === 'binary') {
                startBtn.textContent = 'æº–å‚™æœå°‹';
                startBtn.onclick = () => generateSortedArray();
                pauseBtn.style.display = 'none';
            } else if (algo === 'fibonacci') {
                startBtn.style.display = 'none';
                pauseBtn.style.display = 'none';
            } else {
                startBtn.textContent = 'é–‹å§‹æ’åº';
                startBtn.onclick = startSort;
                startBtn.style.display = 'inline-block';
                pauseBtn.style.display = 'none';
            }
            
            resetArray();
            updateComplexityInfo();
            updateCodeDisplay();
        }

        function showLanguage(language) {
            currentLanguage = language;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            updateCodeDisplay();
        }

        function updateCodeDisplay() {
            const code = codeExamples[currentAlgorithm]?.[currentLanguage] || '// ç¨‹å¼ç¢¼è¼‰å…¥ä¸­...';
            document.getElementById('codeDisplay').textContent = code;
        }

        function generateArray() {
            const size = parseInt(document.getElementById('arraySize').value);
            document.getElementById('sizeValue').textContent = size;
            
            array = [];
            for (let i = 0; i < size; i++) {
                array.push(Math.floor(Math.random() * 99) + 1);
            }
            originalArray = [...array];
            renderArray();
            updateStepInfo('å·²ç”¢ç”Ÿæ–°çš„éš¨æ©Ÿé™£åˆ—');
        }

        function generateSortedArray() {
            generateArray();
            array.sort((a, b) => a - b);
            originalArray = [...array];
            renderArray();
            updateStepInfo('å·²ç”¢ç”Ÿæ’åºå¥½çš„é™£åˆ—ï¼Œå¯ä»¥é–‹å§‹äºŒå…ƒæœå°‹');
        }

        function resetArray() {
            // åœæ­¢ç•¶å‰é‹è¡Œçš„æ’åº
            stopSort();
            
            if (originalArray.length > 0) {
                array = [...originalArray];
                renderArray();
                updateStepInfo('é™£åˆ—å·²é‡ç½®');
            }
        }

        function renderArray() {
            const container = document.getElementById('arrayContainer');
            container.innerHTML = '';
            
            array.forEach((value, index) => {
                const element = document.createElement('div');
                element.className = 'array-element';
                element.textContent = value;
                element.id = `element-${index}`;
                container.appendChild(element);
            });
        }

        function updateStepInfo(message) {
            document.getElementById('stepInfo').textContent = message;
        }

        function updateComplexityInfo() {
            const complexities = {
                selection: {
                    name: 'é¸æ“‡æ’åºæ³•',
                    time: 'O(nÂ²)',
                    space: 'O(1)',
                    description: 'æ¯æ¬¡æ‰¾åˆ°æœ€å°å€¼ä¸¦æ”¾åˆ°æ­£ç¢ºä½ç½®'
                },
                insertion: {
                    name: 'æ’å…¥æ’åºæ³•',
                    time: 'O(nÂ²)',
                    space: 'O(1)',
                    description: 'å°‡æ¯å€‹å…ƒç´ æ’å…¥åˆ°å·²æ’åºéƒ¨åˆ†çš„æ­£ç¢ºä½ç½®'
                },
                bubble: {
                    name: 'æ³¡æ²«æ’åºæ³•',
                    time: 'O(nÂ²)',
                    space: 'O(1)',
                    description: 'é‡è¤‡æ¯”è¼ƒç›¸é„°å…ƒç´ ä¸¦äº¤æ›'
                },
                quick: {
                    name: 'å¿«é€Ÿæ’åºæ³•',
                    time: 'O(n log n)',
                    space: 'O(log n)',
                    description: 'é¸æ“‡åŸºæº–é»ä¸¦åˆ†å‰²é™£åˆ—éè¿´æ’åº'
                },
                binary: {
                    name: 'äºŒå…ƒæœå°‹æ³•',
                    time: 'O(log n)',
                    space: 'O(1)',
                    description: 'åœ¨å·²æ’åºé™£åˆ—ä¸­å¿«é€Ÿæ‰¾åˆ°ç›®æ¨™å€¼'
                },
                fibonacci: {
                    name: 'å‹•æ…‹è¦åŠƒ (Fibonacci)',
                    time: 'O(n) vs O(2â¿)',
                    space: 'O(n) vs O(n)',
                    description: 'ä½¿ç”¨è¨˜æ†¶åŒ–é¿å…é‡è¤‡è¨ˆç®—'
                }
            };

            const info = complexities[currentAlgorithm];
            document.getElementById('complexityInfo').innerHTML = `
                <div class="complexity-card">
                    <h3>${info.name}</h3>
                    <p><strong>æ™‚é–“è¤‡é›œåº¦:</strong> ${info.time}</p>
                    <p><strong>ç©ºé–“è¤‡é›œåº¦:</strong> ${info.space}</p>
                    <p>${info.description}</p>
                </div>
            `;
        }

        async function startSort() {
            if (isRunning && !isPaused) return;
            
            if (isPaused) {
                // ç¹¼çºŒæ’åº
                isPaused = false;
                document.getElementById('startBtn').textContent = 'é–‹å§‹æ’åº';
                document.getElementById('pauseBtn').textContent = 'æš«åœ';
                updateStepInfo('ç¹¼çºŒæ’åº...');
                return;
            }
            
            isRunning = true;
            isPaused = false;
            shouldStop = false;
            animationSpeed = 1100 - parseInt(document.getElementById('speed').value);
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('pauseBtn').style.display = 'inline-block';
            
            try {
                switch (currentAlgorithm) {
                    case 'selection':
                        await selectionSort();
                        break;
                    case 'insertion':
                        await insertionSort();
                        break;
                    case 'bubble':
                        await bubbleSort();
                        break;
                    case 'quick':
                        await quickSort(0, array.length - 1);
                        break;
                }
                
                if (!shouldStop) {
                    // æ¨™è¨˜æ‰€æœ‰å…ƒç´ ç‚ºå·²æ’åº
                    for (let i = 0; i < array.length; i++) {
                        const element = document.getElementById(`element-${i}`);
                        if (element) element.classList.add('sorted');
                    }
                    updateStepInfo('æ’åºå®Œæˆï¼');
                }
            } catch (error) {
                if (error.message !== 'STOPPED') {
                    console.error('æ’åºéç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤:', error);
                }
            }
            
            // é‡ç½®æŒ‰éˆ•ç‹€æ…‹
            isRunning = false;
            isPaused = false;
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('startBtn').textContent = 'é–‹å§‹æ’åº';
            document.getElementById('pauseBtn').style.display = 'none';
        }

        function pauseSort() {
            if (isRunning && !isPaused) {
                isPaused = true;
                document.getElementById('startBtn').style.display = 'inline-block';
                document.getElementById('startBtn').textContent = 'ç¹¼çºŒ';
                document.getElementById('pauseBtn').textContent = 'å·²æš«åœ';
                updateStepInfo('æ’åºå·²æš«åœï¼Œé»æ“Šã€Œç¹¼çºŒã€æŒ‰éˆ•æ¢å¾©');
            }
        }

        function stopSort() {
            if (isRunning) {
                shouldStop = true;
                isPaused = false;
                isRunning = false;
                
                // é‡ç½®æŒ‰éˆ•ç‹€æ…‹
                document.getElementById('startBtn').style.display = 'inline-block';
                document.getElementById('startBtn').textContent = 'é–‹å§‹æ’åº';
                document.getElementById('pauseBtn').style.display = 'none';
                
                // æ¸…é™¤æ‰€æœ‰å‹•ç•«ç‹€æ…‹
                document.querySelectorAll('.array-element').forEach(element => {
                    element.classList.remove('comparing', 'swapping', 'sorted', 'pivot');
                });
                
                updateStepInfo('æ’åºå·²åœæ­¢');
            }
        }

        async function selectionSort() {
            for (let i = 0; i < array.length - 1; i++) {
                if (shouldStop) throw new Error('STOPPED');
                
                let minIndex = i;
                const element_i = document.getElementById(`element-${i}`);
                if (element_i) element_i.classList.add('comparing');
                
                updateStepInfo(`ç¬¬ ${i + 1} è¼ªï¼šå°‹æ‰¾ä½ç½® ${i} åˆ° ${array.length - 1} ä¸­çš„æœ€å°å€¼`);
                
                for (let j = i + 1; j < array.length; j++) {
                    if (shouldStop) throw new Error('STOPPED');
                    
                    const element_j = document.getElementById(`element-${j}`);
                    if (element_j) element_j.classList.add('comparing');
                    await sleep(animationSpeed);
                    
                    if (array[j] < array[minIndex]) {
                        if (minIndex !== i) {
                            const element_min = document.getElementById(`element-${minIndex}`);
                            if (element_min) element_min.classList.remove('comparing');
                        }
                        minIndex = j;
                        updateStepInfo(`æ‰¾åˆ°æ›´å°çš„å€¼ ${array[j]} åœ¨ä½ç½® ${j}`);
                    } else {
                        if (element_j) element_j.classList.remove('comparing');
                    }
                }
                
                if (minIndex !== i) {
                    const element_i_swap = document.getElementById(`element-${i}`);
                    const element_min_swap = document.getElementById(`element-${minIndex}`);
                    if (element_i_swap) element_i_swap.classList.add('swapping');
                    if (element_min_swap) element_min_swap.classList.add('swapping');
                    
                    updateStepInfo(`äº¤æ›ä½ç½® ${i} å’Œ ${minIndex} çš„å…ƒç´ `);
                    
                    // æ’­æ”¾äº¤æ›å‹•ç•«
                    await animateSwap(i, minIndex);
                    
                    [array[i], array[minIndex]] = [array[minIndex], array[i]];
                    renderArray();
                    
                    updateStepInfo(`äº¤æ›å®Œæˆï¼š${array[i]} å’Œ ${array[minIndex]}`);
                }
                
                const final_element = document.getElementById(`element-${i}`);
                if (final_element) {
                    final_element.classList.remove('comparing', 'swapping');
                    final_element.classList.add('sorted');
                }
            }
        }

        async function insertionSort() {
            const first_element = document.getElementById(`element-0`);
            if (first_element) first_element.classList.add('sorted');
            
            for (let i = 1; i < array.length; i++) {
                if (shouldStop) throw new Error('STOPPED');
                
                let key = array[i];
                let j = i - 1;
                
                const element_i = document.getElementById(`element-${i}`);
                if (element_i) element_i.classList.add('comparing');
                updateStepInfo(`æ’å…¥ ${key} åˆ°å·²æ’åºéƒ¨åˆ†`);
                
                while (j >= 0 && array[j] > key) {
                    if (shouldStop) throw new Error('STOPPED');
                    
                    const element_j = document.getElementById(`element-${j}`);
                    const element_j1 = document.getElementById(`element-${j + 1}`);
                    if (element_j) element_j.classList.add('swapping');
                    if (element_j1) element_j1.classList.add('swapping');
                    
                    updateStepInfo(`ç§»å‹• ${array[j]} å‘å³ä¸€ä½`);
                    
                    // æ’­æ”¾ç§»å‹•å‹•ç•«
                    await animateInsert(j, j + 1);
                    
                    array[j + 1] = array[j];
                    renderArray();
                    
                    const element_j_after = document.getElementById(`element-${j}`);
                    const element_j1_after = document.getElementById(`element-${j + 1}`);
                    if (element_j_after) element_j_after.classList.remove('swapping');
                    if (element_j1_after) element_j1_after.classList.remove('swapping');
                    j--;
                }
                
                array[j + 1] = key;
                renderArray();
                
                for (let k = 0; k <= i; k++) {
                    const element_k = document.getElementById(`element-${k}`);
                    if (element_k) element_k.classList.add('sorted');
                }
                
                updateStepInfo(`${key} å·²æ’å…¥åˆ°æ­£ç¢ºä½ç½®`);
                await sleep(animationSpeed);
            }
        }

        async function bubbleSort() {
            for (let i = 0; i < array.length - 1; i++) {
                if (shouldStop) throw new Error('STOPPED');
                
                let swapped = false;
                updateStepInfo(`ç¬¬ ${i + 1} è¼ªæ³¡æ²«æ’åº`);
                
                for (let j = 0; j < array.length - i - 1; j++) {
                    if (shouldStop) throw new Error('STOPPED');
                    
                    const element_j = document.getElementById(`element-${j}`);
                    const element_j1 = document.getElementById(`element-${j + 1}`);
                    if (element_j) element_j.classList.add('comparing');
                    if (element_j1) element_j1.classList.add('comparing');
                    
                    await sleep(animationSpeed);
                    
                    if (array[j] > array[j + 1]) {
                        if (element_j) element_j.classList.add('swapping');
                        if (element_j1) element_j1.classList.add('swapping');
                        
                        updateStepInfo(`äº¤æ› ${array[j]} å’Œ ${array[j + 1]}`);
                        
                        // æ’­æ”¾äº¤æ›å‹•ç•«
                        await animateSwap(j, j + 1);
                        
                        [array[j], array[j + 1]] = [array[j + 1], array[j]];
                        swapped = true;
                        
                        renderArray();
                        updateStepInfo(`äº¤æ›å®Œæˆï¼š${array[j]} å’Œ ${array[j + 1]}`);
                    }
                    
                    const element_j_after = document.getElementById(`element-${j}`);
                    const element_j1_after = document.getElementById(`element-${j + 1}`);
                    if (element_j_after) element_j_after.classList.remove('comparing', 'swapping');
                    if (element_j1_after) element_j1_after.classList.remove('comparing', 'swapping');
                }
                
                const sorted_element = document.getElementById(`element-${array.length - 1 - i}`);
                if (sorted_element) sorted_element.classList.add('sorted');
                
                if (!swapped) {
                    updateStepInfo('æ²’æœ‰ç™¼ç”Ÿäº¤æ›ï¼Œæ’åºæå‰å®Œæˆï¼');
                    break;
                }
            }
        }

        async function quickSort(low, high) {
            if (shouldStop) throw new Error('STOPPED');
            if (low < high) {
                let pi = await partition(low, high);
                await quickSort(low, pi - 1);
                await quickSort(pi + 1, high);
            }
        }

        async function partition(low, high) {
            if (shouldStop) throw new Error('STOPPED');
            
            let pivot = array[high];
            const pivot_element = document.getElementById(`element-${high}`);
            if (pivot_element) pivot_element.classList.add('pivot');
            updateStepInfo(`é¸æ“‡ ${pivot} ä½œç‚ºåŸºæº–é»`);
            
            let i = low - 1;
            
            for (let j = low; j < high; j++) {
                if (shouldStop) throw new Error('STOPPED');
                
                const element_j = document.getElementById(`element-${j}`);
                if (element_j) element_j.classList.add('comparing');
                await sleep(animationSpeed);
                
                if (array[j] < pivot) {
                    i++;
                    if (i !== j) {
                        const element_i = document.getElementById(`element-${i}`);
                        const element_j_swap = document.getElementById(`element-${j}`);
                        if (element_i) element_i.classList.add('swapping');
                        if (element_j_swap) element_j_swap.classList.add('swapping');
                        
                        updateStepInfo(`äº¤æ› ${array[i]} å’Œ ${array[j]}`);
                        
                        // æ’­æ”¾äº¤æ›å‹•ç•«
                        await animateSwap(i, j);
                        
                        [array[i], array[j]] = [array[j], array[i]];
                        renderArray();
                        
                        const element_i_after = document.getElementById(`element-${i}`);
                        const element_j_after = document.getElementById(`element-${j}`);
                        if (element_i_after) element_i_after.classList.remove('swapping');
                        if (element_j_after) element_j_after.classList.remove('swapping');
                    }
                    updateStepInfo(`${array[i]} < ${pivot}ï¼Œç§»åˆ°å·¦å´`);
                }
                
                const element_j_final = document.getElementById(`element-${j}`);
                if (element_j_final) element_j_final.classList.remove('comparing');
            }
            
            const element_i1 = document.getElementById(`element-${i + 1}`);
            const element_high = document.getElementById(`element-${high}`);
            if (element_i1) element_i1.classList.add('swapping');
            if (element_high) element_high.classList.add('swapping');
            
            updateStepInfo(`å°‡åŸºæº–é» ${pivot} ç§»åˆ°æ­£ç¢ºä½ç½®`);
            
            // æ’­æ”¾åŸºæº–é»äº¤æ›å‹•ç•«
            await animateSwap(i + 1, high);
            
            [array[i + 1], array[high]] = [array[high], array[i + 1]];
            renderArray();
            
            const element_i1_final = document.getElementById(`element-${i + 1}`);
            const element_high_final = document.getElementById(`element-${high}`);
            if (element_i1_final) {
                element_i1_final.classList.remove('swapping', 'pivot');
                element_i1_final.classList.add('sorted');
            }
            if (element_high_final) element_high_final.classList.remove('swapping');
            
            updateStepInfo(`åŸºæº–é» ${pivot} å·²æ”¾åˆ°æ­£ç¢ºä½ç½®`);
            return i + 1;
        }

        async function startBinarySearch() {
            const target = parseInt(document.getElementById('searchTarget').value);
            if (isNaN(target)) {
                updateStepInfo('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å­—');
                return;
            }
            
            updateStepInfo(`é–‹å§‹æœå°‹ ${target}`);
            const result = await binarySearch(target);
            
            if (result !== -1) {
                document.getElementById('searchResult').textContent = `æ‰¾åˆ°äº†ï¼${target} åœ¨ä½ç½® ${result}`;
                document.getElementById(`element-${result}`).classList.add('sorted');
            } else {
                document.getElementById('searchResult').textContent = `æ²’æœ‰æ‰¾åˆ° ${target}`;
            }
        }

        async function binarySearch(target) {
            let left = 0;
            let right = array.length - 1;
            
            while (left <= right) {
                if (shouldStop) throw new Error('STOPPED');
                
                let mid = Math.floor((left + right) / 2);
                
                // æ¸…é™¤ä¹‹å‰çš„æ¨™è¨˜
                document.querySelectorAll('.array-element').forEach(el => {
                    el.classList.remove('comparing', 'swapping');
                });
                
                // æ¨™è¨˜æœå°‹ç¯„åœ
                for (let i = left; i <= right; i++) {
                    const element = document.getElementById(`element-${i}`);
                    if (element) element.classList.add('comparing');
                }
                const mid_element = document.getElementById(`element-${mid}`);
                if (mid_element) mid_element.classList.add('swapping');
                
                updateStepInfo(`æœå°‹ç¯„åœ [${left}, ${right}]ï¼Œæª¢æŸ¥ä¸­é–“ä½ç½® ${mid}ï¼š${array[mid]}`);
                await sleep(animationSpeed * 2);
                
                if (array[mid] === target) {
                    updateStepInfo(`æ‰¾åˆ°ç›®æ¨™å€¼ ${target}ï¼`);
                    return mid;
                } else if (array[mid] < target) {
                    updateStepInfo(`${array[mid]} < ${target}ï¼Œæœå°‹å³åŠéƒ¨`);
                    left = mid + 1;
                } else {
                    updateStepInfo(`${array[mid]} > ${target}ï¼Œæœå°‹å·¦åŠéƒ¨`);
                    right = mid - 1;
                }
            }
            
            updateStepInfo(`æœå°‹å®Œç•¢ï¼Œæœªæ‰¾åˆ° ${target}`);
            return -1;
        }

        function calculateFibonacci() {
            const n = parseInt(document.getElementById('fibInput').value);
            if (isNaN(n) || n < 1) {
                updateStepInfo('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ­£æ•´æ•¸');
                return;
            }
            
            // éè¿´æ–¹æ³•
            let recursiveCalls = 0;
            const startRecursive = performance.now();
            
            function fibRecursive(num) {
                recursiveCalls++;
                if (num <= 1) return num;
                return fibRecursive(num - 1) + fibRecursive(num - 2);
            }
            
            const recursiveResult = fibRecursive(n);
            const recursiveTime = performance.now() - startRecursive;
            
            // å‹•æ…‹è¦åŠƒæ–¹æ³•
            let dpCalls = 0;
            const startDP = performance.now();
            
            function fibDP(num) {
                const dp = [0, 1];
                for (let i = 2; i <= num; i++) {
                    dpCalls++;
                    dp[i] = dp[i - 1] + dp[i - 2];
                }
                return dp[num];
            }
            
            const dpResult = fibDP(n);
            const dpTime = performance.now() - startDP;
            
            // é¡¯ç¤ºçµæœ
            document.getElementById('fibResult').textContent = `Fibonacci(${n}) = ${dpResult}`;
            document.getElementById('recursiveResult').innerHTML = 
                `æ™‚é–“: ${recursiveTime.toFixed(2)} ms<br>å‘¼å«æ¬¡æ•¸: ${recursiveCalls}`;
            document.getElementById('dpResult').innerHTML = 
                `æ™‚é–“: ${dpTime.toFixed(2)} ms<br>è¨ˆç®—æ¬¡æ•¸: ${dpCalls}`;
            
            updateStepInfo(`å‹•æ…‹è¦åŠƒæ¯”éè¿´å¿«äº† ${(recursiveTime / dpTime).toFixed(1)} å€ï¼`);
        }

        async function animateSwap(index1, index2) {
            const element1 = document.getElementById(`element-${index1}`);
            const element2 = document.getElementById(`element-${index2}`);
            
            if (!element1 || !element2) return;
            
            // æ·»åŠ äº¤æ›å‹•ç•«
            if (index1 < index2) {
                element1.classList.add('slide-right');
                element2.classList.add('slide-left');
            } else {
                element1.classList.add('slide-left');
                element2.classList.add('slide-right');
            }
            
            // ç­‰å¾…å‹•ç•«å®Œæˆ
            await sleep(800);
            
            // æ¸…é™¤å‹•ç•«é¡åˆ¥
            element1.classList.remove('slide-left', 'slide-right');
            element2.classList.remove('slide-left', 'slide-right');
        }
        
        async function animateInsert(fromIndex, toIndex) {
            const element = document.getElementById(`element-${fromIndex}`);
            if (!element) return;
            
            // æ·»åŠ æ’å…¥å‹•ç•«
            if (fromIndex > toIndex) {
                element.classList.add('moving-up');
            } else {
                element.classList.add('moving-down');
            }
            
            // ç­‰å¾…å‹•ç•«å®Œæˆ
            await sleep(600);
            
            // æ¸…é™¤å‹•ç•«é¡åˆ¥
            element.classList.remove('moving-up', 'moving-down');
        }

        async function sleep(ms) {
            return new Promise((resolve, reject) => {
                const checkPause = () => {
                    if (shouldStop) {
                        reject(new Error('STOPPED'));
                        return;
                    }
                    if (isPaused) {
                        setTimeout(checkPause, 100);
                        return;
                    }
                    setTimeout(resolve, ms);
                };
                checkPause();
            });
        }
    </script>
</body>
</html>
